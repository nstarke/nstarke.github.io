<!DOCTYPE html>
<html>
<head>
<title>0055-acer-bios-analysis.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="acer-predator-helios-300-complaint--bios-analysis">ACER Predator Helios 300 Complaint / BIOS Analysis</h1>
<p>Published: July 28, 2021</p>
<p>Recently I saw <a href="https://news.ycombinator.com/item?id=27703014">this hacker news post</a> regarding this <a href="https://www.amazon.com/gp/customer-reviews/RKILN7HFLF4CS/">Amazon review</a> of an Acer Predator Helios 300 Gaming Laptop.  The complaint in the review is that the Secure Boot settings are disabled by default on Amazon-sold units of this laptop. The latest BIOS image for this laptop can be found here: <a href="https://www.acer.com/ac/en/US/content/support-product/8376">https://www.acer.com/ac/en/US/content/support-product/8376</a>. As of this writing the latest version is <code>2.02</code> released 5/21/2021.</p>
<p>What I wanted to learn is whether or not there was a configuration option that would disable the Secure Boot <code>Enable / Disable</code> switch in the Firmware UI. If so, how could we circumvent this implementation?</p>
<p>Extracting the UEFI image:</p>
<pre class="hljs"><code><div>$ binwalk GH53M202.exe

Scan Time:     2021-07-28 20:42:22
Target File:   /home/nick/acer-predator-helios-300/GH53M202.exe
MD5 Checksum:  c113ee83aee992091d05d1a1efb88735
Signatures:    404

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             Microsoft executable, portable (PE)
179           0xB3            Copyright string: &quot;Copyright (C) 2000 CW Sandmann (sandmann@clio.rice.edu).&quot;
256           0x100           Copyright string: &quot;Copyright (C) 1993-1995 DJ Delorie.&quot;
349           0x15D           Copyright string: &quot;copyright&quot;
590965        0x90475         7-zip archive data, version 0.2
2002445       0x1E8E0D        MySQL MISAM index file Version 11

$ dd if=GH53M202.exe of=bios.7z bs=590965 skip=1
36+1 records in
36+1 records out
21787157 bytes (22 MB, 21 MiB) copied, 0.0501695 s, 434 MB/s
$ 7z x bios.7z

7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=C.UTF-8,Utf16=on,HugeFiles=on,64 bits,8 CPUs Intel(R) Xeon(R) CPU E5-2660 v2 @ 2.20GHz (306E4),ASM,AES-NI)

Scanning the drive for archives:
1 file, 21787157 bytes (21 MiB)

Extracting archive: bios.7z
--
Path = bios.7z
Type = 7z
Physical Size = 21787157
Headers Size = 522
Method = LZMA:24 BCJ
Solid = +
Blocks = 2

Everything is Ok

Files: 16
Size:       41384967
Compressed: 21787157
$ ls
BiosImageProcx64.dll  FH53Mx64.fd   FlsHook.exe   GH53Mx64.fd      H2OFFT.cat  H2OFFT64.sys                 Microsoft.VC90.MFC.manifest  mfc90u.dll   msvcr90.dll
Ding.wav              FWUpdLcl.exe  GH53M202.exe  H2OFFT-Wx64.exe  H2OFFT.inf  Microsoft.VC90.CRT.manifest  bios.7z                      msvcp90.dll  platform.ini
</div></code></pre>
<p>There are two UEFI firmware files embedded in the executable:</p>
<pre class="hljs"><code><div>$ ls -lah *.fd
-rw-rw-r-- 1 nick nick 18M Mar 24 06:13 FH53Mx64.fd
-rw-rw-r-- 1 nick nick 18M Mar 24 06:13 GH53Mx64.fd
</div></code></pre>
<p>I ran <a href="https://github.com/LongSoft/UEFITool/releases/tag/A58">UEFIExtract</a> against <code>*.fd</code> and this splits out all the consolidated UEFI Modules into PE32 files.  I need to run <a href="https://github.com/LongSoft/Universal-IFR-Extractor/releases/tag/0.3.7">IFR-Extract</a> against all the files in the outputed <code>.dump</code> directory.  I do this by developing a small shell script and then running the <code>find</code> command with it, saved as ~/extractor.sh.</p>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/sh</span>
ifrextract <span class="hljs-string">"{}"</span> <span class="hljs-string">"{}.extract.txt"</span>
</div></code></pre>
<p>Then run this with the <code>find</code> command against all <code>*.body.bin</code> files in the <code>.dump</code> directory:</p>
<pre class="hljs"><code><div>$ find . -type f -name &quot;*.body.bin&quot; -execdir $HOME/extractor.sh {} \;
</div></code></pre>
<p>This will output many lines, most of which are errors. When we are done, we want to look at any <code>*.extract.txt</code> that are non-trivial.  I did this by looking for all <code>*.extract.txt</code> files that are larger than 2k:</p>
<pre class="hljs"><code><div>$ find . -type f -name &quot;*.extract.txt&quot; -size +2k
</div></code></pre>
<p><img src="images/0055/uefitool.PNG" alt="UEFI Tool" title="UEFI Tool Screenshot"></p>
<p>This lead me to <code>SetupUtility</code> which seems to be in UEFI format and can be parsed by <code>ifrextract</code>. You can right click on this entry in UEFITool and click <code>Extract Body</code> to save the body of the binary to the local filesystem.  Then you can run <code>ifrextract</code> against this file you have saved.</p>
<p>Opening this file in a text editor and perusing this file leads me to find the following conditional logic surrounding Secure Boot:</p>
<h2 id="gh53mx64fd">GH53Mx64.fd</h2>
<pre class="hljs"><code><div>Gray Out If {19 82}
0x123503 				QuestionId: 0x5 equals value 0x2 {12 86 05 00 02 00}
0x123509 					QuestionId: 0x2 equals value 0x1 {12 06 02 00 01 00}
0x12350F 					Or {16 02}
0x123511 					QuestionId: 0x4 equals value 0x0 {12 06 04 00 00 00}
0x123517 					Or {16 02}
0x123519 				End {29 02}
0x12351B 				One Of: Secure Boot:, VarStoreInfo (VarOffset/VarName): 0xFC, VarStore: 0x1234, QuestionId: 0xAE20, Size: 1, Min: 0x0, Max 0x1, Step: 0x0 {05 91 B1 00 B2 00 20 AE 34 12 FC 00 04 10 00 01 00}
0x12352C 					One Of Option: Enabled, Value (8 bit): 0x1 (default) {09 07 56 01 10 00 01}
0x123533 					One Of Option: Disabled, Value (8 bit): 0x0 {09 07 55 01 00 00 00}
0x12353A 				End One Of {29 02}
0x12353C 			End If {29 02}
</div></code></pre>
<h2 id="fh53mx64fd">FH53Mx64.fd</h2>
<pre class="hljs"><code><div>Gray Out If {19 82}
0x123503 				QuestionId: 0x5 equals value 0x2 {12 86 05 00 02 00}
0x123509 					QuestionId: 0x2 equals value 0x1 {12 06 02 00 01 00}
0x12350F 					Or {16 02}
0x123511 					QuestionId: 0x4 equals value 0x0 {12 06 04 00 00 00}
0x123517 					Or {16 02}
0x123519 				End {29 02}
0x12351B 				One Of: Secure Boot:, VarStoreInfo (VarOffset/VarName): 0xFC, VarStore: 0x1234, QuestionId: 0xAE20, Size: 1, Min: 0x0, Max 0x1, Step: 0x0 {05 91 B1 00 B2 00 20 AE 34 12 FC 00 04 10 00 01 00}
0x12352C 					One Of Option: Enabled, Value (8 bit): 0x1 (default) {09 07 56 01 10 00 01}
0x123533 					One Of Option: Disabled, Value (8 bit): 0x0 {09 07 55 01 00 00 00}
0x12353A 				End One Of {29 02}
0x12353C 			End If {29 02}
</div></code></pre>
<p>These sections are identical.</p>
<h2 id="analysis">Analysis</h2>
<p>It does indeed appear as though there is a configuration option that grays out the Secure Boot settings. The question becomes is this configuration option set by default in the stock firmware available online? My guess is that it is not, but discovering this through reverse engineering is difficult.  It would be interesting to see though if updating the BIOS of a unit sold through Amazon with the BIOS image available from ACER and see if that enables those options.</p>
<h2 id="alternative-options">Alternative Options</h2>
<p>I think it would likewise be possible to &quot;undo&quot; the graying out by changing the expected values in the firmware image for each of the three QuestionIds (0x2, 0x4, 0x5). For example, on QuestionId 0x5:</p>
<p>Change:</p>
<pre class="hljs"><code><div>12 86 05 00 02 00
</div></code></pre>
<p>To:</p>
<pre class="hljs"><code><div>12 86 05 00 01 00
</div></code></pre>
<p>The difference is in the 5th byte (<code>0x2</code> in the first line) to a value that is not <code>0x2</code> in the second line (<code>0x1</code> in the second line).</p>
<p>And so on for questions 0x2 and 0x4 if modifying QuestionId 0x5 did not work, since it appears the QuestionIds are <code>OR</code>'d.</p>
<p>Then you would need to reflash the SPI NOR with a flash programmer. Note that this is an inherently risky approach and you should back up your BIOS image before attempting to make this modification and flash.</p>
<p>You would need to first back up your UEFI image by attaching a flash programmer to the SPI NOR chip and dumping its contents.  Then you would open the dumped binary data in UEFITool, and make the modifications using UEFITool against the full, dumped image.  I do not have the funds to actually buy the laptop off Amazon, but if you do or have purchased the laptop off Amazon, try flashing the stock firmware image, and if that doesn't work then pursue the alternative method.</p>
<p>If all else fails, reflash with your backup image.</p>
<p><a href="/">Back</a></p>

</body>
</html>
